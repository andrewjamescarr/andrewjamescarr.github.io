
name: Deploy GitHub Pages on Release

on:
  release:
    types: [published]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Copy site files
        run: |
          mkdir public
          cp -r * public/ || true

      # Markdown to HTML conversion for version file.
      - name: Convert Markdown to HTML
        run: |
          pip install markdown
          python - <<'EOF'
          import markdown
          import pathlib

          md_path = pathlib.Path("version.md")
          out_path = pathlib.Path("public/version.html")

          if md_path.exists():
              md = md_path.read_text()
              html = markdown.markdown(md)
              out_path.write_text(f"<html><body>{html}</body></html>")
          else:
              print("version.md not found â€” skipping conversion")
          EOF

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: public

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
